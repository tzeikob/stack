#!/usr/bin/env sh

clear

selection=${NNN_SEL:-${XDG_CONFIG_HOME:-$HOME/.config}/nnn/.selection}

printf "(s)election/(c)urrent? [default=c] "
read -r resp

if [ "$resp" = "s" ]; then
  files=$(tr '\0' '\n' < "$selection")

  printf "\nFile(s) to remove:\n"
  printf "%s\n" "$files"
  printf "Do you want to proceed? [y/N] "
  read -r confirm

  if [ "$confirm" = "y" ] || [ "$confirm" = "Y" ]; then
    sed 's|'"$PWD/"'||g' < "$selection" | xargs -0 -I {} rm -rf {}
  fi
else
  file="$PWD/$1"

  printf "\nFile to remove:\n"
  printf "%s\n" "$file"
  printf "Do you want to proceed? [y/N] "
  read -r confirm

  if [ "$confirm" = "y" ] || [ "$confirm" = "Y" ]; then
    rm -rf "$file"
  fi
fi

# Clear selection
if [ "$resp" = "s" ] && [ -p "$NNN_PIPE" ]; then
  printf "-" > "$NNN_PIPE"
fi
