#!/usr/bin/env sh

while true
do
  clear

  echo -e "Mount/unmount a disk device"
  read -p "(l)ocal (n)etwork (q)uit: " reply

  if [ "$reply" = "l" ]; then
    echo -e ""
    lsblk

    read -p "Enter device name (sdbX): " device
    echo -e ""

    if grep -qs "$device " /proc/mounts; then
      sync

      if udisksctl unmount -b /dev/"$device"
      then
        echo -e "Device '$device' unmounted successfully"

        if udisksctl power-off -b /dev/"$device"
        then
          echo -e "Device '$device' can now be ejected"
        else
          echo -e "Failed to power off device '$device'"
        fi
      else
        echo -e "Failed to umount device '$device'"
      fi
    else
      if udisksctl mount -b "/dev/$device"
      then
        echo -e "Device '$device' mounted to $(lsblk -n /dev/"$device" | rev | cut -d' ' -f1 | rev)"
      else
        echo -e "Failed to mount device '$device'"
      fi
    fi
  elif [ "$reply" = "n" ]; then
    read -p "Enter shared folder name: " shared_folder
    mnt_point="/run/media/$USER/network/$shared_folder"

    if grep -qs "$mnt_point " /proc/mounts; then
      sync

      if umount "$mnt_point"
      then
        echo -e "Device '$mnt_point' unmounted successfully"
      else
        echo -e "Failed to umount device '$mnt_point'"
      fi
    else
      sudo mkdir -p $mnt_point
      sudo chown -R $USER:$USER /run/media/$USER/network

      read -p "Enter device ip or host name: " host
      read -p "Enter user name: " username

      sudo mount.cifs //$host/$shared_folder $mnt_point -o user=$username,rw,iocharset=utf8,uid=$USER,gid=$USER

      if [ $? -eq 0 ]; then
        echo -e "Device //$host/$shared_folder mounted on $mnt_point successfully"
      else
        echo -e "Failed to mount device from //$host/$shared_folder"
      fi
    fi
  else
    clear
    exit
  fi

  printf "Enter any char to continue (q to quit): "
  read -r reply

  if [ "$reply" = "q" ]; then
    clear
    exit
  fi
done
